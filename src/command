/*!
 * Copyright (c) 2018 Aaron Delasy
 * Licensed under the MIT License
 */

fn command (
  compiler: str,
  action: str,
  path: str,
  outputPath: str,
  qs: str
) {
  filePath := fs_realpathSync(path)

  if !fs_existsSync(filePath) {
    RaiseError("File '" + filePath + "' does not exists")
  } elif !fs_isFileSync(filePath) {
    RaiseError("Path '" + filePath + "' is not a file")
  }

  if (action == "lex" || action == "parse") && compiler.empty() {
    data := request(ENDPOINT_URL + "/" + action + qs, filePath)
    print(data.str(), terminator: "")
  } elif action == "lex" || action == "parse" {
    data := customCompile(compiler, action, filePath, outputPath)
    print(data.str(), terminator: "")
  } elif action == "compile" && compiler.empty() {
    data := request(ENDPOINT_URL + "/" + action + qs, filePath)
    fs_writeFileSync(outputPath, data)
    chmodAddSync(outputPath, 0o111)
  } elif action == "compile" {
    customCompile(compiler, action, filePath, outputPath)
    chmodAddSync(outputPath, 0o111)
  }
}
